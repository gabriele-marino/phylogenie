# --------------------------------
# 7. BD trees with contact tracing
# --------------------------------

# This tutorial walks you through setting up a configuration file to simulate phylogenetic trees with a birth-death with contact tracing (BD-CT) model. Contact tracing extension of multi-type birth-death (MTBD) models was introduced by Zhukova & Gascuel (https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1012461).

# Contact tracing duplicates the states of the model, creating a new contact tracing (-CT) state for each original state, to model the dynamics of notified contacts of sampled individuals. In this example, we will add contact tracing to the simple BD model, thus resulting in two states: infectious (I) and notified infectious (I-CT).

# In this example, we generate a dataset with 100 samples. For each sample:
# - The reproduction number is drawn from a lognormal distribution (mean=1, sigma=0.2);
# - The sampling proportion is drawn from a uniform distribution (low=0.1, high=0.7).
# - The infectious period is fixed at 2.5.
# - The notification probability is drawn from a uniform distribution (low=0.3, high=0.9).
# - The maximum number of notified contacts is drawn from an integer distribution (low=1, high=6).

# For each simulation, a target number of tips between 50 and 250 is drawn uniformly at random, and the simulation ends when the target number of tips is reached.

# ---------------
# General configs
# ---------------

output_dir: outputs/BD-CT-Trees
data_type: trees
n_samples: 100
n_jobs: -1
seed: 42

# -------
# Context
# -------

context:
  R_0:
    type: lognormal
    mean: 1
    sigma: 0.2
  s:
    type: uniform
    low: 0
    high: 0.7
  p:
    type: uniform
    low: 0.3
    high: 0.9
  C:
    type: integers
    low: 1
    high: 6 # Note: high is exclusive, so this will generate integers from 1 to 5
  n_tips:
    type: integers
    low: 50
    high: 250

# ------------------------------------
# Parameterization-specific parameters
# ------------------------------------

parameterization: BD
reproduction_number: R_0
sampling_proportion: s
infectious_period: 2.5

# --------------------------
# Contact tracing parameters
# --------------------------

# Contact tracing parameters can be added to the configuration file to simulate contact tracing dynamics when using a BD, BDEI, BDSS, or epidemiological parameterization. Here we specify the notification probability (which is a SkylineParameter) and the maximum number of notified contacts (which is an integer).

notification_probability: p
max_notified_contacts: C

# Additional (optional) parameters for contact tracing are:
# - samplable_states_after_notification: list of str (None by default)
#   The states from which individuals can be sampled after notification. If not provided, all states will be considered samplable.
# - sampling_rate_after_notification: SkylineParameter (~infinity by default)
#   The rate at which individuals are sampled after notification.

# --------------------------
# Tree simulation parameters
# --------------------------

init_state: I
n_tips: n_tips
timeout: 5