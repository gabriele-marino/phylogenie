# ------------------------
# 5. Epidemiological trees
# ------------------------

# This tutorial walks you through setting up a configuration file to simulate phylogenetic trees with a generic multi-type birth-death (MTBD) model using the epidemiological parameterization.

# The canonical parameterization of an MTBD model with m states/populations is characterized by the following parameters:
# - An m-dimensional vector of reproduction numbers;
# - An m-dimensional vector of become uninfectious rates;
# - An m-dimensional vector of sampling proportions;
# - An mx(m-1)-dimensional matrix of migration (transition) rates;
# - An mx(m-1)-dimensional matrix of reproduction numbers among states.

# In this example, we will use the generic epidemiological parameterization to model a birth-death with exposed-infectious (BDEI) process, reproducing the dataset of the 2.BDEI-Trees.yaml example.

# ---------------
# General configs
# ---------------

output_dir: outputs/Epidemiological-Trees
data_type: tree
n_samples:
  train: 100
  val: 10
  test: 10
n_jobs: -1
seed: 42

# -------
# Context
# -------

context:
  R_0:
    type: lognormal
    mean: 1
    sigma: 0.2
  T:
    type: lognormal
    mean: 1
    sigma: 0.3
  f:
    type: uniform
    low: 0
    high: 0.75
  s:
    type: uniform
    low: 0.2
    high: 0.4
    size: 3
  n_leaves:
    type: integers
    low: 50
    high: 250

# ---------------------
# Tree generator config
# ---------------------

tree_generator:
  init_state: E
  n_leaves: n_leaves
  
  timeout: 5

  # -----------------------
  # Parameterization config
  # -----------------------

  # The epidemiological parameterization uses three SkylineVectors:
  # - sampling_proportions;
  # - reproduction_numbers (equal to 0 by default);
  # - become_uninfectious_rates (equal to 0 by default);
  # and two SkylineMatrices, that can be provided when the model involves more than one state:
  # - migration_rates (None by default).
  # - reproduction_numbers_among_states (None by default);
  # It also needs you to specify the states involved in the simulation, as a list of strings, and assumes removal after sampling.

  spec: phylogenie.epidemiological
  states: [E, I]
  become_uninfectious_rates: [0, 1 / ((1 - f) * T)] # Become uninfectious rate for I is the inverse of the infectious period
  migration_rates: [[1 / (f * T)], [0]] # Migration rate from E to I is the inverse of the incubation period
  reproduction_numbers_among_states: [[0], [R_0]] # Reproduction number from E to I is 0, from I to E is R_0
  sampling_proportions:
    - 0 # Only sample infectious individuals
    - value: s
      change_times: [1.0, 2.0]
